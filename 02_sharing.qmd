---
title: "Sharing R packages"
subtitle: "Develop an R package within an hour"
format: 
  html:
    embed-resources: true
filters:
  - toggle
toggle:
  output-toggle: true    # Enable toggle functionality
  output-hidden: true   # Show outputs initially (default)
  output-sync: true     # Individual control (default)
---

### Create a package website

Next to the built-in support generated by documenting your package (such as the help files), a potential user of your package would benefit greatly from a package website. See for example the package website of the imputation package [`mice`](https://amices.org/mice/). This website was created with just a few lines of code, with the `pkgdown` package.

If you're programming in RStudio, and you want to load a package's website, just run:
```{r, eval=FALSE}
usethis::browse_package("mice")
```
::: {.callout-tip}
When asked which website to visit, choose `amices.org/mice`:
```
Which URL do you want to visit? (0 to exit) 

1: https://github.com/amices/mice        (URL field in DESCRIPTION)
2: https://amices.org/mice/              (URL field in DESCRIPTION)
3: https://stefvanbuuren.name/fimd/      (URL field in DESCRIPTION)
4: https://github.com/amices/mice/issues (BugReports field in DESCRIPTION)

Selection: 
```
Selecting option `2` will direct you to the package home page.
:::

It is very easy to create a website for your R package with `pkgdown` tools. First, set-up the website structure using:
```{r, eval=FALSE}
usethis::use_pkgdown()
```

Then load a preview of the website with:
```{r, eval=FALSE}
pkgdown::build_site()
```

As you'll see, this is quite a bare bones website, but it has all the structure you need: a landing page to explain what the package is set up to do, a reference page with an overview of all of the R functions that are available in your package, and some information about who built the package and how others can use it. 

### Add contents to the website

To add more content to the website, we should create a markdown file with some information about our package. It is good practice to create an R Markdown `README` document, because this allows us to showcase the functionality of our package with code chunks. You can edit this R Markdown file as you would any markdown or Quarto document. `pkgdown` will then programmatically generate a plain markdown version of this document to show on the package website.

Generate a `README` file as follows:
```{r, eval=FALSE}
usethis::use_readme_rmd()
```

This will generate a template file for you to fill in, with prompts such as:

```
The goal of roundR is to ...

## Installation

You can install the development version of roundR like so:

```

::: {.callout-tip}
Notice the comment all the way at the top of the `Rmd` file?
```
<!-- README.md is generated from README.Rmd. Please edit that file -->
```
Don't remove this as this will serve as a reminder for any contributor on your package not to edit the programmatically generated plain markdown file.
:::

Edit the `README.Rmd` file by adding the goal of the package:
```{r, eval=FALSE}
The goal of roundR is to offer a numeric rounding to the nearest integer, as opposed to the [base::round()] default to round to the nearest *even* integer.
```
And add an example:
```{r, eval=FALSE}
library(roundR)
## basic example code
round(2.5)
round_to_integer(2.5)
```
Then remove all text below the example, starting with `What is special about` all the way to the end of the file.

The `README.Rmd` file now contains the aim of the package and an example. To generate the plain markdown version that will be recognized by `pkgdown`, run:
```{r, eval=FALSE}
devtools::build_readme()
```

Now, we can re-render the package website:
```{r, eval=FALSE}
pkgdown::build_site()
```

::: {.callout-tip}
Notice that we haven't replaced some of the `README` template? 
```r
# FILL THIS IN! HOW CAN PEOPLE INSTALL YOUR DEV PACKAGE?
```
That's because we haven't uploaded the package to GitHub, for others to be able to install the package with `devtools::install_github()`. Let's do that now!
:::

We have created a fully functioning package website. Let's upload it to GitHub to share it with the world.

### Uploading to GitHub

::: {.callout-tip}
This section assumes that you are logged into your GitHub account. If you have trouble realizing this, [GitHub has a great step-by-step walk through](https://docs.github.com/en/desktop/installing-and-configuring-github-desktop/installing-and-authenticating-to-github-desktop). 
:::

Let's publish our R package to GitHub. To do so, we need to perform two steps. First, we must log (commit) our changes to the `git` distributed version control system. This stores the file changes to our own machine. Next we must link our local `git` to a remote online repository on GitHub. Luckily, with 'GitHub Desktop', we can perform all these steps in a single window interface. 

Let's start by adding our R package to GitHub Desktop. Remember that we already started the package in RStudio as a `git` repository, so we only have to point GitHub Desktop to the correct directory.
<center>
![](img/addgitrepo.gif){width=90%}
</center>

Next, we commit the changes. This means that we save the state of files for a moment in time, so that we can always revert to that state and see how the files changed with respect to the previous state. 
<center>
![](img/commit.gif){width=90%}
</center>

::: {.callout-tip}
Naturally, you would not only do this at the start (when RStudio created the `git` repository) and end (when we have a working package), but at regular and informative intervals. For example, when you add a function, a test, a help file, a license, etcetera. 
:::

Now that we have commited our package, we can publish it on GitHub.
<center>
![](img/publish_gh.gif){width=90%}
</center>

### Review the package on GitHub

Find your online GitHub repositories at [https://github.com](https://github.com). You will see your package there, and that the license and README are automatically recognized. 

Now, we can edit the `README` file to add how others can install the package. We can do this locally (in RStudio on your PC), or edit the file on GitHub.

### Edit the `README` file 

Now that our package is online, if we want to make changes to the package, we should avoid introducing bugs on the live version. The live version of the package is in the `main` branch, which we should protect against breaking changes. 

We will extend our workflow with a good behavior: not working in the `main` branch. We would not want to accidentally overwrite or break the functionality of our package, for example when working in parallel in the same branch. So let's add a new `development` branch. 

Create a new branch named `development`. Navigate to the `README.Rmd` file and replace the template text for installation with the code to install it from your repository, for example:
```{r, eval=FALSE}
devtools::install_github("hanneoberman/roundR")
```

<!-- Commit the changes to the `development` branch.   -->
<!-- ### Add a README file -->

<!-- Click the `Add a README` button on the GitHub repository. Commit the changes to a new branch called `development`.  -->

<!-- <center> -->
<!-- ![](img/addREADME.gif){width=90%} -->
<!-- </center> -->

When we commit the changes in the `README` file to the `development` branch, a new window opens to propose the `pull request` (PR). The PR is nothing more than a request to the package developers to pull your proposed changes into (usually) the `main` branch of the software.
Since we are the developers, we have to both create and accept the PR.
<center>
![](img/openpr.gif){width=90%}
</center>

It is good procedure to write an informative PR message, usually outlining the nature and rationale of the changes. I also demonstrate how to accept a PR, thereby approving the changes per file (only one now) and signing it with my initials. I cannot formally *approve* my own PR, since that would leave great opportunity for subjectivity or error. Proper procedure would be to have someone else check and approve your changes.

<center>
![](img/pullrequest.gif){width=90%}
</center>

When you go back to GitHub Desktop and `fetch` the changes on the remote (that would be GitHub online), you will see that you have now access to the `README` file and the `development` branch.

<!-- TODO: open locally to re-render website/use GH Pages website? -->

<!-- Now, we can re-render the package website: -->
<!-- ```{r, eval=FALSE} -->
<!-- pkgdown::build_site() -->
<!-- ``` -->

### Registering a `DOI`
Now that we have a proper and open source package online and the world as our user base, it would be wise to allow for proper referencing of our package.

GitHub and `Zenodo` have paired to facilitate this procedure. If you link your `Zenodo` account to GitHub, [as outlined here](https://docs.github.com/en/repositories/archiving-a-github-repository/referencing-and-citing-content), you only have to click, copy and paste to fully make your GitHub repo citeable. 

<center>
![](img/doi.gif){width=90%}
</center>

### Add citation
`Zenodo` prepares the repository citation for us. We can simply grab the info, change our personal information and submit it to GitHub. 

<center>
![](img/citation.gif){width=90%}
</center>

The final step before we would put our package *out there* is to notify how users can refer to our package. Run the following code:
```{r eval = FALSE}
usethis::use_citation()
```
which will create the necessary citation files for modification
```{r eval = FALSE}
✔ Creating 'inst/'
✔ Writing 'inst/CITATION'
• Modify 'inst/CITATION'
```

We can now simply grab the text and/or `bibtex` citation from GitHub and paste it into the `CITATION` file. The citation info cf. R packages could be:
```{r eval=FALSE}
citHeader("To cite roundR in publications use:")

citEntry(
  entry    = "Manual",
  title    = "hanneoberman/roundR: Version 0.1.0 - First release",
  author   = "Gerko Vink and Hanne Oberman",
  year     = "2025",
  doi      = "10.5281/zenodo.7668889",
  url      = "github.com/gerkovink/roundR",
  textVersion = paste(
"Vink, G and Oberman, H.I. (2025). gerkovink/roundR: Version 0.1.0 - First release (Version v0.2.0) [Computer software]. https://doi.org/10.5281/zenodo.7668889"
  )
)
```

Modify this to your name and paste it into the `CITATION` file.

<center>
![](img/use_citation.gif){width=90%}
</center>

### Installing your own package from GitHub
Go to GitHub Desktop, and commit and push the changes to GitHub. Then run the following code block:
```{r}
#| eval: false

devtools::install_github("hanneoberman/roundR")
```
where you replace `"hanneoberman/roundR"` with your GitHub handle and repository name. 

<center>
![](img/install_github.gif){width=90%}
</center>

That's it! Please see the [Take aways](03_take-aways.qmd) tab for some final remarks and advanced topics.